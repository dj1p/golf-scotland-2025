<!DOCTYPE html>
<html lang="no">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cullen 2025</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 10px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .header {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            text-align: center;
        }
        
        .header h1 {
            color: #2d3748;
            margin-bottom: 10px;
            font-size: 24px;
        }
        
        .header p {
            color: #718096;
            font-size: 14px;
        }
        
        .lang-toggle {
            position: fixed;
            top: 10px;
            right: 10px;
            background: white;
            padding: 8px 15px;
            border-radius: 10px;
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            z-index: 1000;
            font-size: 14px;
        }
        
        .version-badge {
            position: fixed;
            bottom: 10px;
            right: 10px;
            background: rgba(255, 255, 255, 0.9);
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 12px;
            color: #718096;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .nav-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .nav-card {
            background: white;
            border-radius: 15px;
            padding: 20px 15px;
            text-align: center;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .nav-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
        }
        
        .nav-card h3 {
            color: #2d3748;
            margin: 10px 0 5px;
            font-size: 16px;
        }
        
        .nav-card p {
            color: #718096;
            font-size: 12px;
        }
        
        .icon {
            font-size: 40px;
            line-height: 1.2;
            margin-bottom: 10px;
        }
        
        .content {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            display: none;
            max-width: 100%;
            overflow-x: auto;
        }
        
        .content.active {
            display: block;
        }
        
        .back-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 8px;
            cursor: pointer;
            margin-bottom: 15px;
            font-size: 14px;
        }
        
        .back-btn:hover {
            background: #5a67d8;
        }
        
        .schedule-item {
            background: #f7fafc;
            border-left: 4px solid #48bb78;
            padding: 12px;
            margin-bottom: 12px;
            border-radius: 0 8px 8px 0;
            font-size: 14px;
        }
        
        .flight-section {
            background: #edf2f7;
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
        }
        
        .flight-item {
            background: white;
            padding: 8px;
            margin: 5px 0;
            border-radius: 5px;
            font-size: 13px;
        }
        
        .player-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
        }
        
        .player-card {
            background: #f7fafc;
            padding: 12px;
            border-radius: 10px;
            border: 2px solid #e2e8f0;
            font-size: 14px;
        }
        
        .player-card h4 {
            color: #2d3748;
            margin-bottom: 5px;
            font-size: 16px;
        }
        
        .player-card p {
            color: #718096;
            font-size: 12px;
        }
        
        .scorecard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
            gap: 8px;
            margin: 15px 0;
        }
        
        .hole-input {
            background: #f7fafc;
            padding: 10px;
            border-radius: 8px;
            border: 2px solid #e2e8f0;
        }
        
        .hole-input.stroke {
            background: #fef5e7;
            border-color: #f6d55c;
        }
        
        .hole-input label {
            display: block;
            font-weight: bold;
            margin-bottom: 5px;
            color: #2d3748;
            font-size: 12px;
        }
        
        .hole-input input {
            width: 100%;
            padding: 6px;
            border: 1px solid #cbd5e0;
            border-radius: 5px;
            font-size: 14px;
        }
        
        button {
            background: #48bb78;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px;
        }
        
        button:hover {
            background: #38a169;
        }
        
        .round-select, .team-select {
            background: #f7fafc;
            padding: 12px;
            margin-bottom: 8px;
            border-radius: 10px;
            cursor: pointer;
            border: 2px solid #e2e8f0;
            font-size: 14px;
        }
        
        .round-select:hover, .team-select:hover {
            background: #edf2f7;
        }
        
        select {
            padding: 8px;
            border: 1px solid #cbd5e0;
            border-radius: 5px;
            font-size: 14px;
            width: 100%;
            margin: 10px 0;
        }
        
        .table-wrapper {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            margin: 10px 0;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 12px;
        }
        
        th, td {
            padding: 8px 5px;
            text-align: center;
            border: 1px solid #e2e8f0;
            white-space: nowrap;
        }
        
        th {
            background: #f7fafc;
            font-weight: bold;
            color: #2d3748;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        td:first-child, th:first-child {
            text-align: left;
            position: sticky;
            left: 0;
            background: white;
            z-index: 5;
            min-width: 80px;
            font-weight: bold;
        }
        
        th:first-child {
            background: #f7fafc;
            z-index: 11;
        }
        
        .success-message {
            background: #48bb78;
            color: white;
            padding: 10px;
            border-radius: 8px;
            margin-top: 10px;
            text-align: center;
            font-size: 14px;
        }
        
        .overall-section {
            background: linear-gradient(135deg, #ffd89b 0%, #19547b 100%);
            padding: 15px;
            border-radius: 15px;
            margin-bottom: 20px;
        }
        
        .overall-section h3 {
            color: white;
            margin-bottom: 10px;
            font-size: 18px;
        }
        
        .overall-table {
            background: white;
            border-radius: 10px;
            overflow: hidden;
        }
        
        .trophy {
            color: gold;
            margin-right: 5px;
        }
        
        .team-section {
            background: #edf2f7;
            padding: 10px;
            border-radius: 10px;
            margin: 10px 0;
            font-size: 14px;
        }
        .collapsible {
    background: #667eea;
    color: white;
    cursor: pointer;
    padding: 12px 15px;
    width: 100%;
    border: none;
    text-align: left;
    outline: none;
    font-size: 15px;
    border-radius: 8px;
    margin-top: 15px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.collapsible:hover {
    background: #5a67d8;
}

.collapsible:after {
    content: '\002B';
    color: white;
    font-weight: bold;
    float: right;
    margin-left: 5px;
}

.collapsible.active:after {
    content: "\2212";
}

.collapsible-content {
    padding: 0 18px;
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.2s ease-out;
    background-color: #f7fafc;
    border-radius: 0 0 8px 8px;
    margin-bottom: 10px;
}

.collapsible-content.show {
    max-height: 2000px;
    padding: 18px;
    transition: max-height 0.3s ease-in;
}
        .course-section {
            border-top: 3px solid #667eea;
            margin: 20px 0;
            padding-top: 15px;
        }
        
        .scramble-result {
            background: #e6fffa;
            border: 2px solid #38b2ac;
            padding: 8px;
            border-radius: 8px;
            margin: 8px 0;
            font-size: 14px;
        }
        
        .winner {
            background: #c6f6d5;
            border-color: #48bb78;
        }
        
        .admin-section {
            background: #fff5f5;
            border: 2px solid #fc8181;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
        }

        .course-management-section {
    background: #fff5f5;
    border: 2px solid #4299e1;
    padding: 15px;
    border-radius: 10px;
    margin: 15px 0;
}

.course-management-section h4 {
    color: #2b6cb0;
    margin-bottom: 15px;
}

.holes-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
    gap: 10px;
    margin-bottom: 20px;
}

.hole-card {
    background: white;
    border: 2px solid #e2e8f0;
    border-radius: 8px;
    padding: 10px;
}

.hole-card h5 {
    font-size: 14px;
    color: #2d3748;
    margin-bottom: 8px;
    text-align: center;
    background: #edf2f7;
    padding: 5px;
    border-radius: 5px;
}
        
        .admin-section h4 {
            color: #c53030;
            margin-bottom: 10px;
        }
        
        .award-select {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin: 10px 0;
        }
        
        .award-input {
            background: white;
            padding: 10px;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
        }
        
        .award-input label {
            display: block;
            font-size: 12px;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        .handicap-edit-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin: 15px 0;
        }
        
        .handicap-edit-item {
            background: white;
            padding: 10px;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
        }
        
        .handicap-edit-item label {
            display: block;
            font-size: 12px;
            margin-bottom: 5px;
            font-weight: bold;
            color: #2d3748;
        }
        
        .handicap-edit-item input {
            width: 100%;
            padding: 6px;
            border: 1px solid #cbd5e0;
            border-radius: 5px;
            font-size: 14px;
        }
        
        .nine-section {
            margin-bottom: 20px;
        }
        
        .nine-section h5 {
            margin-bottom: 10px;
            color: #2d3748;
            font-size: 14px;
        }
        
        .scramble-handicap-info {
            background: #e6f4ff;
            border: 2px solid #4299e1;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
        }
        
        .scramble-handicap-info h5 {
            color: #2b6cb0;
            margin-bottom: 10px;
        }
        
        .scramble-handicap-info p {
            margin: 5px 0;
            font-size: 14px;
        }
        
        @media (max-width: 768px) {
            .nav-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .header h1 {
                font-size: 20px;
            }
            
            .nav-card h3 {
                font-size: 14px;
            }
            
            .nav-card p {
                font-size: 11px;
            }
            
            table {
                font-size: 11px;
            }
            
            th, td {
                padding: 5px 3px;
            }
            
            .scorecard-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }
        
        .stats-badge {
            position: fixed;
            bottom: 10px;
            left: 10px;
            background: rgba(255, 255, 255, 0.95);
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 11px;
            color: #718096;
            box-shadow: 0 4px 10px rgba(0,0,0,0.15);
            display: none;
            max-width: 250px;
            z-index: 1000;
            border: 1px solid #e2e8f0;
        }
        
        .stats-badge.active {
            display: block;
        }
        
        .stats-badge h5 {
            margin: 0 0 8px 0;
            color: #2d3748;
            font-size: 13px;
            border-bottom: 1px solid #e2e8f0;
            padding-bottom: 5px;
        }
        
        .stats-badge p {
            margin: 3px 0;
            font-size: 11px;
        }
        
        .stats-badge .close-stats {
            position: absolute;
            top: 5px;
            right: 8px;
            cursor: pointer;
            color: #cbd5e0;
            font-size: 14px;
        }
        
        .stats-badge .close-stats:hover {
            color: #718096;
        }
    </style>
</head>
<body>
    <div class="lang-toggle" onclick="toggleLanguage()">
        <span id="langBtn">🇬🇧 EN</span>
    </div>

    <div class="version-badge" onclick="toggleStats(event)">v3.16</div>
    
    <div class="stats-badge" id="statsBadge">
        <span class="close-stats" onclick="hideStats()">×</span>
        <h5>📊 Statistics</h5>
        <p>Page Views: <strong id="pageViews">0</strong></p>
        <p>Unique Visitors: <strong id="uniqueVisitors">0</strong></p>
        <p>Today: <strong id="todayViews">0</strong></p>
        <p>Most Viewed: <strong id="mostViewed">-</strong></p>
        <p>Last Visit: <strong id="lastVisit">-</strong></p>
        <p>Scores Entered: <strong id="scoresEntered">0</strong></p>
    </div>

    <div class="container">
        <div class="header">
            <h1 id="appTitle">Cullen 2025</h1>
            <p id="appSubtitle">Årlig golftur til Skottland</p>
        </div>
        
        <div id="homeView" class="view">
            <div class="nav-grid">
                <div class="nav-card" onclick="showView('schedule')">
                    <div class="icon" style="font-size: 40px;">&#128197;</div>
                    <h3 id="scheduleTitle">Timeplan</h3>
                    <p id="scheduleDesc">Se runder</p>
                </div>
                
                <div class="nav-card" onclick="showView('scorecard')">
                    <div class="icon" style="font-size: 40px;">&#9971;</div>
                    <h3 id="scorecardTitle">Registrer</h3>
                    <p id="scorecardDesc">Legg inn score</p>
                </div>
                
                <div class="nav-card" onclick="showView('leaderboard')">
                    <div class="icon" style="font-size: 40px;">&#127942;</div>
                    <h3 id="leaderboardTitle">Resultater</h3>
                    <p id="leaderboardDesc">Live stilling</p>
                </div>
                
                <div class="nav-card" onclick="showView('courses')">
                    <div class="icon" style="font-size: 40px;">&#127948;</div>
                    <h3 id="coursesTitle">Baner</h3>
                    <p id="coursesDesc">Scorekort</p>
                </div>
                
                <div class="nav-card" onclick="showView('players')">
                    <div class="icon" style="font-size: 40px;">&#128101;</div>
                    <h3 id="playersTitle">Spillere</h3>
                    <p id="playersDesc">Handicap</p>
                </div>
                
                <div class="nav-card" onclick="showView('history')">
                    <div class="icon" style="font-size: 40px;">&#128218;</div>
                    <h3 id="historyTitle">Historie</h3>
                    <p id="historyDesc">Spillte baner</p>
                </div>
                
                <div class="nav-card" onclick="showView('whisky')">
                    <div class="icon" style="font-size: 40px;">&#129347;</div>
                    <h3 id="whiskyTitle">Whisky</h3>
                    <p id="whiskyDesc">Samlingen</p>
                </div>
                
                <div class="nav-card" onclick="showView('weather')">
                    <div class="icon" style="font-size: 40px;">&#9925;</div>
                    <h3 id="weatherTitle">Vær</h3>
                    <p id="weatherDesc">Værmelding</p>
                </div>
                
                <div class="nav-card" onclick="showView('admin')">
                    <div class="icon" style="font-size: 40px;">&#128272;</div>
                    <h3 id="adminTitle">Admin</h3>
                    <p id="adminDesc">Administrer</p>
                </div>
            </div>
        </div>
        
        <div id="scheduleView" class="content">
            <button class="back-btn" onclick="showView('home')">← Tilbake</button>
            <h2>Turneringsplan</h2>
            <div id="scheduleContent"></div>
        </div>
        
        <div id="scorecardView" class="content">
            <button class="back-btn" onclick="showView('home')">← Tilbake</button>
            <h2>Registrer Score</h2>
            <div id="scorecardContent"></div>
        </div>
        
        <div id="leaderboardView" class="content">
            <button class="back-btn" onclick="showView('home')">← Tilbake</button>
            <h2>Resultatliste</h2>
            <div id="leaderboardContent"></div>
        </div>
        
        <div id="coursesView" class="content">
            <button class="back-btn" onclick="showView('home')">← Tilbake</button>
            <h2>Scorekort per Bane</h2>
            <div id="coursesContent"></div>
        </div>
        
        <div id="playersView" class="content">
            <button class="back-btn" onclick="showView('home')">← Tilbake</button>
            <h2>Spillere</h2>
            <div id="playersContent"></div>
        </div>
        
        <div id="historyView" class="content">
            <button class="back-btn" onclick="showView('home')">← Tilbake</button>
            <h2>Spillte Baner Gjennom Årene</h2>
            <div id="historyContent"></div>
        </div>
        
        <div id="whiskyView" class="content">
            <button class="back-btn" onclick="showView('home')">← Tilbake</button>
            <h2>Whisky Samlingen</h2>
            <div id="whiskyContent"></div>
        </div>
        
        <div id="weatherView" class="content">
            <button class="back-btn" onclick="showView('home')">← Tilbake</button>
            <h2>Værmelding for alle baner</h2>
            <div id="weatherContent"></div>
        </div>
        
        <div id="adminView" class="content">
            <button class="back-btn" onclick="showView('home')">← Tilbake</button>
            <h2>Administrator</h2>
            <div id="adminContent"></div>
        </div>
    </div>

    <script>
        // Complete Golf App JavaScript
        var players = [
            { id: 1, name: 'Klaus', handicap: 18.1 },
            { id: 2, name: 'Ruben', handicap: 11 },
            { id: 3, name: 'Sigbjørn', handicap: 20.2 },
            { id: 4, name: 'Bjørn', handicap: 23.8 },
            { id: 5, name: 'Truls', handicap: 36 },
            { id: 6, name: 'Tor Espen', handicap: 27 },
            { id: 7, name: 'Dag', handicap: 19.4 },
            { id: 8, name: 'Roar', handicap: 25.9 }
        ];
        
        // Historical played courses data
        var playedCourses = [
            { id: 1, name: 'Murryshall GC - Old Course', years: [2010, 2014, 2018] },
            { id: 2, name: 'Murryshall GC - New Course', years: [2010, 2014, 2018] },
            { id: 3, name: 'Newmacher GC - Hawkshill', years: [2010, 2011, 2012, 2018, 2022] },
            { id: 4, name: 'Newmacher GC - Swailend', years: [2013] },
            { id: 5, name: 'Cruden Bay', years: [2011, 2013, 2015] },
            { id: 6, name: 'Criff GC', years: [2010] },
            { id: 7, name: 'Gleneagle GC - Kings Course', years: [2010] },
            { id: 8, name: 'Royal Aberdeen GC', years: [2012] },
            { id: 9, name: 'Craibstone GC', years: [2011, 2016] },
            { id: 10, name: 'Hazelhead GC - Bane 1', years: [2012] },
            { id: 11, name: 'Hazelhead GC - Bane 2', years: [2012] },
            { id: 12, name: 'Newburgh on Ythan GC', years: [2013] },
            { id: 13, name: 'Meldrum', years: [2015] },
            { id: 14, name: 'Cullen GC', years: [2016] },
            { id: 15, name: 'Duff House Royal GC', years: [2016] },
            { id: 16, name: 'Lundin GC', years: [2017] },
            { id: 17, name: 'Craighead Links', years: [2017] },
            { id: 18, name: 'Balcomie Links', years: [2017] },
            { id: 19, name: 'St. Andrew Eden Course', years: [2017] },
            { id: 20, name: 'St. Andrew GC', years: [2019] },
            { id: 21, name: 'Crail Golf Society', years: [2021] },
            { id: 22, name: 'Stonehaven GC', years: [2021] },
            { id: 23, name: 'Leven GC', years: [2021] },
            { id: 24, name: 'Nairn Golf Club', years: [2022] },
            { id: 25, name: 'Nairn Dunbar Golf Club', years: [2022] },
            { id: 26, name: 'Cullen Links', years: [2023, 2024] },
            { id: 27, name: 'Spey Bay', years: [2023, 2024] },
            { id: 28, name: 'Strathlene', years: [2023, 2024] },
            { id: 29, name: 'Garmouth & Kingston', years: [2023, 2024] }
        ];
        
        // Load saved played courses if exists
        var savedPlayedCourses = localStorage.getItem('playedCourses2025');
        if (savedPlayedCourses) {
            try {
                var parsed = JSON.parse(savedPlayedCourses);
                if (Array.isArray(parsed) && parsed.length > 0) {
                    playedCourses = parsed;
                }
            } catch (e) {
                console.log('Using default played courses');
            }
        }
        
        // Whisky collection data
        var whiskyCollection = [
            { id: 1, owner: 'Ruben', primary: '', reserve: '' },
            { id: 2, owner: 'Dag', primary: 'Glenmorangie', reserve: '' },
            { id: 3, owner: 'Bjørn', primary: 'Highland Park', reserve: '' },
            { id: 4, owner: 'Sigbjørn', primary: 'MacAllan', reserve: '' },
            { id: 5, owner: 'Truls', primary: 'Dalmore', reserve: 'Old Pultney' },
            { id: 6, owner: 'Roar', primary: 'Glenfiddich', reserve: '' },
            { id: 7, owner: 'Tor Espen', primary: 'Ben Nevis', reserve: '' },
            { id: 8, owner: 'Klaus', primary: 'Balvenie', reserve: '' }
        ];
        
        // Load saved whisky collection if exists
        var savedWhisky = localStorage.getItem('whiskyCollection2025');
        if (savedWhisky) {
            try {
                var parsed = JSON.parse(savedWhisky);
                if (Array.isArray(parsed) && parsed.length > 0) {
                    whiskyCollection = parsed;
                }
            } catch (e) {
                console.log('Using default whisky collection');
            }
        }
        
        var schedule = [
            { 
                id: 1, 
                date: 'Fredag 29. aug', 
                time: 'Morgen', 
                course: 'Cullen Links', 
                type: 'Scramble',
                longestDrive: [5, 15],
                closestToPin: [2, 13],
                teams: [
                    ['Klaus', 'Ruben'],
                    ['Sigbjørn', 'Bjørn'],
                    ['Truls', 'Tor Espen'],
                    ['Dag', 'Roar']
                ],
                flights: []
            },
            { 
                id: 2, 
                date: 'Fredag 29. aug', 
                time: 'Ettermiddag', 
                course: 'Cullen Links', 
                type: 'Individuell',
                longestDrive: [5, 15],
                closestToPin: [2, 13],
                flights: [
                    { time: '', players: ['Klaus', 'Ruben', 'Roar', 'Sigbjørn'] },
                    { time: '', players: ['Dag', 'Tor Espen', 'Truls', 'Bjørn'] }
                ]
            },
            { 
                id: 3, 
                date: 'Lørdag 30. aug', 
                time: 'Morgen', 
                course: 'Spey Bay', 
                type: 'Individuell',
                longestDrive: [5, 16],
                closestToPin: [4, 15],
                flights: [
                    { time: '', players: ['Klaus', 'Tor Espen', 'Sigbjørn', 'Bjørn'] },
                    { time: '', players: ['Dag', 'Ruben', 'Truls', 'Roar'] }
                ]
            },
            { 
                id: 4, 
                date: 'Lørdag 30. aug', 
                time: 'Ettermiddag', 
                course: 'Garmouth & Kingston', 
                type: 'Scramble',
                longestDrive: [8],
                closestToPin: [3],
                teams: [
                    ['Truls', 'Roar'],
                    ['Klaus', 'Sigbjørn'],
                    ['Bjørn', 'Dag'],
                    ['Ruben', 'Tor Espen']
                ],
                flights: []
            },
            { 
                id: 5, 
                date: 'Søndag 31. aug', 
                time: 'Hele dagen', 
                course: 'Strathlene', 
                type: 'Individuell',
                longestDrive: [8],
                closestToPin: [7],
                flights: [
                    { time: '', players: ['Klaus', 'Dag', 'Roar', 'Truls'] },
                    { time: '', players: ['Ruben', 'Sigbjørn', 'Tor Espen', 'Bjørn'] }
                ]
            }
        ];
        
        var courses = {
            'Cullen Links': { 
                slopeRating: 113, 
                par: 63,
                pars: [4,3,3,3,4,3,3,4,3,4,3,3,3,3,5,4,4,4],
                handicaps: [9,7,1,11,3,13,5,17,15,14,6,2,4,8,10,12,18,16]
            },
            'Spey Bay': { 
                slopeRating: 115, 
                par: 70,
                pars: [4,4,4,3,4,4,4,3,5,4,4,4,3,4,3,5,4,4],
                handicaps: [3,11,7,9,1,17,5,13,15,16,8,4,10,2,14,12,18,6]
            },
            'Strathlene': { 
                slopeRating: 117, 
                par: 69,
                pars: [4,4,4,3,4,4,3,4,4,4,4,4,3,5,4,4,4,3],
                handicaps: [12,16,7,5,9,10,18,3,1,14,8,2,17,11,4,15,6,13]
            },
            'Garmouth & Kingston': { 
                slopeRating: 112, 
                par: 67,
                pars: [4,4,4,3,4,4,4,4,3,4,4,4,3,4,3,4,4,3],
                handicaps: [7,8,1,9,10,5,14,3,12,6,15,17,18,11,13,2,4,16]
            }
        };
        
        var language = 'no';
        var scores = {};
        var scrambleScores = {};
        var awards = {};
        var scrambleWinners = {};
        var isAdmin = false;
        
        // Statistics tracking
        var stats = JSON.parse(localStorage.getItem('golfStats2025') || '{}');
        if (!stats.pageViews) stats.pageViews = 0;
        if (!stats.uniqueVisitors) stats.uniqueVisitors = [];
        if (!stats.dailyViews) stats.dailyViews = {};
        if (!stats.pageViewCounts) stats.pageViewCounts = {};
        if (!stats.lastVisit) stats.lastVisit = new Date().toISOString();
        
        // Track page view
        function trackPageView(page) {
            stats.pageViews = (stats.pageViews || 0) + 1;
            
            // Track daily views
            var today = new Date().toISOString().split('T')[0];
            if (!stats.dailyViews[today]) stats.dailyViews[today] = 0;
            stats.dailyViews[today]++;
            
            // Track page specific views
            if (!stats.pageViewCounts[page]) stats.pageViewCounts[page] = 0;
            stats.pageViewCounts[page]++;
            
            // Track unique visitor
            var visitorId = localStorage.getItem('visitorId2025');
            if (!visitorId) {
                visitorId = 'visitor_' + Date.now() + '_' + Math.random();
                localStorage.setItem('visitorId2025', visitorId);
            }
            if (stats.uniqueVisitors.indexOf(visitorId) === -1) {
                stats.uniqueVisitors.push(visitorId);
            }
            
            stats.lastVisit = new Date().toISOString();
            localStorage.setItem('golfStats2025', JSON.stringify(stats));
            updateStatsDisplay();
        }
        
        // Update stats display
        function updateStatsDisplay() {
            document.getElementById('pageViews').textContent = stats.pageViews || 0;
            document.getElementById('uniqueVisitors').textContent = (stats.uniqueVisitors || []).length;
            
            var today = new Date().toISOString().split('T')[0];
            document.getElementById('todayViews').textContent = stats.dailyViews[today] || 0;
            
            // Find most viewed page
            var mostViewed = '-';
            var maxViews = 0;
            Object.keys(stats.pageViewCounts || {}).forEach(function(page) {
                if (stats.pageViewCounts[page] > maxViews) {
                    maxViews = stats.pageViewCounts[page];
                    mostViewed = page;
                }
            });
            document.getElementById('mostViewed').textContent = mostViewed;
            
            // Last visit
            if (stats.lastVisit) {
                var lastVisitDate = new Date(stats.lastVisit);
                var timeStr = lastVisitDate.toLocaleTimeString('no-NO', { hour: '2-digit', minute: '2-digit' });
                document.getElementById('lastVisit').textContent = timeStr;
            }
            
            // Count scores entered
            var scoreCount = 0;
            Object.keys(scores).forEach(function(key) {
                scoreCount += Object.keys(scores[key]).length;
            });
            Object.keys(scrambleScores).forEach(function(key) {
                scoreCount += Object.keys(scrambleScores[key]).length;
            });
            document.getElementById('scoresEntered').textContent = scoreCount;
        }
        
        // Toggle stats display (secret: triple-click on version badge)
        var clickCount = 0;
        var clickTimer = null;
        
        function toggleStats(event) {
            clickCount++;
            
            if (clickCount === 3) {
                document.getElementById('statsBadge').classList.toggle('active');
                updateStatsDisplay();
                clickCount = 0;
            }
            
            clearTimeout(clickTimer);
            clickTimer = setTimeout(function() {
                clickCount = 0;
            }, 500);
        }
        
        function hideStats() {
            document.getElementById('statsBadge').classList.remove('active');
        }
        // Collapsible rows in Admin Console
function toggleSection(element) {
    element.classList.toggle("active");
    var content = element.nextElementSibling;
    content.classList.toggle("show");
}
        // Function to calculate scramble team handicap
        function calculateScrambleHandicap(teamMembers, courseName) {
            var course = courses[courseName];
            var courseHandicaps = [];
            
            teamMembers.forEach(function(memberName) {
                var player = players.find(function(p) { return p.name === memberName; });
                if (player) {
                    var courseHandicap = Math.round((player.handicap * course.slopeRating) / 113);
                    courseHandicaps.push(courseHandicap);
                }
            });
            
            // Sort to find lowest and highest
            courseHandicaps.sort(function(a, b) { return a - b; });
            
            if (courseHandicaps.length >= 2) {
                // 70% of lowest + 30% of highest - keep one decimal
                var lowest = courseHandicaps[0];
                var highest = courseHandicaps[courseHandicaps.length - 1];
                var teamHandicap = (lowest * 0.7) + (highest * 0.3);
                return Math.round(teamHandicap * 10) / 10; // Round to 1 decimal
            } else if (courseHandicaps.length === 1) {
                // If only one player (shouldn't happen in scramble)
                return courseHandicaps[0];
            }
            
            return 0;
        }
        
        // Initialize with sync from server if available
        async function syncWithServer() {
            try {
                var response = await fetch('/api/scores');
                if (response.ok) {
                    var serverData = await response.json();
                    scores = serverData.scores || scores;
                    scrambleScores = serverData.scrambleScores || scrambleScores;
                    awards = serverData.awards || awards;
                    scrambleWinners = serverData.scrambleWinners || scrambleWinners;
                    if (serverData.players && Array.isArray(serverData.players) && serverData.players.length > 0) {
                        players = serverData.players;
                    }
                    if (serverData.schedule && Array.isArray(serverData.schedule) && serverData.schedule.length > 0) {
                        schedule = serverData.schedule;
                    }
                    if (serverData.playedCourses && Array.isArray(serverData.playedCourses) && serverData.playedCourses.length > 0) {
                        playedCourses = serverData.playedCourses;
                    }
                    if (serverData.whiskyCollection && Array.isArray(serverData.whiskyCollection) && serverData.whiskyCollection.length > 0) {
                        whiskyCollection = serverData.whiskyCollection;
                    }
                    if (serverData.courses) {
                courses = serverData.courses;
                localStorage.setItem('golfCourses2025', JSON.stringify(courses));
            }
                    localStorage.setItem('golfScores2025', JSON.stringify(scores));
                    localStorage.setItem('scrambleScores2025', JSON.stringify(scrambleScores));
                    localStorage.setItem('golfAwards2025', JSON.stringify(awards));
                    localStorage.setItem('scrambleWinners2025', JSON.stringify(scrambleWinners));
                    localStorage.setItem('golfPlayers2025', JSON.stringify(players));
                    localStorage.setItem('golfSchedule2025', JSON.stringify(schedule));
                    localStorage.setItem('playedCourses2025', JSON.stringify(playedCourses));
                    localStorage.setItem('whiskyCollection2025', JSON.stringify(whiskyCollection));
                    localStorage.setItem('golfCourses2025', JSON.stringify(courses));  // Add this line
                }
            } catch (e) {
                console.log('Using local storage only');
            }
        }
        
        // Save to server
        async function saveToServer() {
            try {
                await fetch('/api/scores', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        scores, 
                        scrambleScores, 
                        awards, 
                        scrambleWinners, 
                        players, 
                        schedule, 
                        playedCourses, 
                        whiskyCollection,
                        courses
                    })
                });
            } catch (e) {
                console.log('Saved locally only');
            }
        }
        
        function showView(viewName) {
            document.querySelectorAll('.content').forEach(function(el) {
                el.classList.remove('active');
            });
            document.getElementById('homeView').style.display = viewName === 'home' ? 'block' : 'none';
            
            if (viewName !== 'home') {
                document.getElementById(viewName + 'View').classList.add('active');
                if (viewName === 'schedule') loadSchedule();
                if (viewName === 'scorecard') loadScorecard();
                if (viewName === 'leaderboard') loadLeaderboard();
                if (viewName === 'courses') loadCourses();
                if (viewName === 'players') loadPlayers();
                if (viewName === 'history') loadHistory();
                if (viewName === 'whisky') loadWhisky();
                if (viewName === 'weather') loadWeather();
                if (viewName === 'admin') loadAdmin();
            }
            
            // Track page view
            trackPageView(viewName);
        }
        
        function toggleLanguage() {
            language = language === 'no' ? 'en' : 'no';
            document.getElementById('langBtn').textContent = language === 'no' ? '🇬🇧 EN' : '🇳🇴 NO';
            updateLanguage();
        }
        
        function updateLanguage() {
            var texts = {
                no: {
                    appTitle: 'Cullen 2025',
                    appSubtitle: 'Årlig golftur til Skottland',
                    scheduleTitle: 'Timeplan',
                    scheduleDesc: 'Se runder',
                    scorecardTitle: 'Registrer',
                    scorecardDesc: 'Legg inn score',
                    leaderboardTitle: 'Resultater',
                    leaderboardDesc: 'Live stilling',
                    coursesTitle: 'Baner',
                    coursesDesc: 'Scorekort',
                    playersTitle: 'Spillere',
                    playersDesc: 'Handicap',
                    historyTitle: 'Historie',
                    historyDesc: 'Spillte baner',
                    whiskyTitle: 'Whisky',
                    whiskyDesc: 'Samlingen',
                    weatherTitle: 'Vær',
                    weatherDesc: 'Værmelding',
                    adminTitle: 'Admin',
                    adminDesc: 'Administrer'
                },
                en: {
                    appTitle: 'Cullen 2025',
                    appSubtitle: 'Annual Golf Trip to Scotland',
                    scheduleTitle: 'Schedule',
                    scheduleDesc: 'View rounds',
                    scorecardTitle: 'Enter',
                    scorecardDesc: 'Add scores',
                    leaderboardTitle: 'Results',
                    leaderboardDesc: 'Live scores',
                    coursesTitle: 'Courses',
                    coursesDesc: 'Scorecards',
                    playersTitle: 'Players',
                    playersDesc: 'Handicaps',
                    historyTitle: 'History',
                    historyDesc: 'Played courses',
                    whiskyTitle: 'Whisky',
                    whiskyDesc: 'Collection',
                    weatherTitle: 'Weather',
                    weatherDesc: 'Forecast',
                    adminTitle: 'Admin',
                    adminDesc: 'Manage'
                }
            };
            
            var t = texts[language];
            Object.keys(t).forEach(function(key) {
                var el = document.getElementById(key);
                if (el) el.textContent = t[key];
            });
        }
        
        function loadSchedule() {
            var html = '';
            schedule.forEach(function(round) {
                html += '<div class="schedule-item">';
                html += '<strong>' + round.date + ' - ' + round.time + '</strong><br>';
                html += round.course + '<br>';
                html += '<span style="color: #4299e1;">' + round.type + '</span>';
                
                if (round.type === 'Individuell' && round.flights && round.flights.length > 0) {
                    html += '<div class="flight-section"><strong>Flights:</strong>';
                    round.flights.forEach(function(flight, j) {
                        html += '<div class="flight-item">';
                        html += '<strong>Flight ' + (j + 1) + ':</strong> ';
                        html += flight.players.join(', ');
                        if (flight.time) {
                            html += ' (' + flight.time + ')';
                        }
                        html += '</div>';
                    });
                    html += '</div>';
                }
                
                if (round.teams) {
                    html += '<div class="team-section"><strong>Lag:</strong><br>';
                    round.teams.forEach(function(team, j) {
                        html += '<div>Lag ' + (j + 1) + ': ' + team.join(' & ');
                        
                        // Show team handicap for scrambles
                        var teamHandicap = calculateScrambleHandicap(team, round.course);
                        html += ' <span style="color: #718096; font-size: 12px;">(Team HCP: ' + teamHandicap.toFixed(1) + ')</span>';
                        
                        if (round.teamTimes && round.teamTimes[j]) {
                            html += ' - ' + round.teamTimes[j];
                        }
                        html += '</div>';
                    });
                    html += '</div>';
                }
                
                if (round.longestDrive) {
                    html += '<div>🚀 Lengste drive: Hull ' + round.longestDrive.join(', ') + '</div>';
                }
                if (round.closestToPin) {
                    html += '<div>🎯 Nærmest pinnen: Hull ' + round.closestToPin.join(', ') + '</div>';
                }
                
                html += '</div>';
            });
            document.getElementById('scheduleContent').innerHTML = html;
        }
        
        function loadScorecard() {
            var html = '<h3>Velg runde:</h3>';
            schedule.forEach(function(round) {
                html += '<div class="round-select" onclick="selectRound(' + round.id + ')">';
                html += '<strong>' + round.date + ' - ' + round.time + '</strong><br>';
                html += round.course + ' (' + round.type + ')';
                html += '</div>';
            });
            html += '<div id="scorecardForm"></div>';
            document.getElementById('scorecardContent').innerHTML = html;
        }
        
        function selectRound(roundId) {
            var round = schedule.find(function(r) { return r.id === roundId; });
            var html = '<h3>' + round.course + ' - ' + round.date + '</h3>';
            
            if (round.type === 'Scramble') {
                html += '<h4>Velg lag:</h4>';
                round.teams.forEach(function(team, idx) {
                    var teamHandicap = calculateScrambleHandicap(team, round.course);
                    html += '<div class="team-select" onclick="selectTeam(' + roundId + ', ' + idx + ')">';
                    html += '<strong>Lag ' + (idx + 1) + '</strong><br>';
                    html += team.join(' & ');
                    html += '<br><span style="color: #718096; font-size: 12px;">Team Handicap: ' + teamHandicap.toFixed(1) + '</span>';
                    html += '</div>';
                });
            } else {
                html += '<h4>Velg spiller:</h4>';
                html += '<select id="playerSelect" onchange="loadScorecardForm()">';
                html += '<option value="">-- Velg spiller --</option>';
                players.forEach(function(player) {
                    html += '<option value="' + player.id + '">' + player.name + '</option>';
                });
                html += '</select>';
                html += '<input type="hidden" id="selectedRound" value="' + roundId + '">';
                html += '<div id="holesForm"></div>';
            }
            
            document.getElementById('scorecardForm').innerHTML = html;
        }
        
        function selectTeam(roundId, teamIdx) {
            var round = schedule.find(function(r) { return r.id === roundId; });
            var team = round.teams[teamIdx];
            var course = courses[round.course];
            var scoreKey = roundId + '_team_' + teamIdx;
            var existingScores = scrambleScores[scoreKey] || {};
            var teamHandicap = calculateScrambleHandicap(team, round.course);
            
            var html = '<h3>' + round.course + ' - ' + round.date + '</h3>';
            html += '<h4>Lag ' + (teamIdx + 1) + ': ' + team.join(' & ') + '</h4>';
            
            // Show scramble handicap info
            html += '<div class="scramble-handicap-info">';
            html += '<h5>Scramble Handicap Beregning</h5>';
            
            var courseHandicaps = [];
            team.forEach(function(memberName) {
                var player = players.find(function(p) { return p.name === memberName; });
                if (player) {
                    var courseHandicap = Math.round((player.handicap * course.slopeRating) / 113);
                    courseHandicaps.push({ name: memberName, handicap: courseHandicap });
                    html += '<p>' + memberName + ': HCP ' + player.handicap + ' → Bane HCP ' + courseHandicap + '</p>';
                }
            });
            
            // Sort to show calculation
            courseHandicaps.sort(function(a, b) { return a.handicap - b.handicap; });
            if (courseHandicaps.length >= 2) {
                var lowest = courseHandicaps[0].handicap;
                var highest = courseHandicaps[courseHandicaps.length - 1].handicap;
                html += '<p style="margin-top: 10px; color: #4299e1;">Laveste HCP: ' + lowest + ' × 70% = ' + (lowest * 0.7).toFixed(1) + '</p>';
                html += '<p style="color: #4299e1;">Høyeste HCP: ' + highest + ' × 30% = ' + (highest * 0.3).toFixed(1) + '</p>';
            }
            
            html += '<p><strong>Team Handicap: ' + teamHandicap.toFixed(1) + ' slag</strong></p>';
            html += '<p style="color: #718096; font-size: 12px;">Netto score = Brutto - ' + teamHandicap.toFixed(1) + '</p>';
            html += '</div>';
            
            html += '<h4>Registrer lagscore:</h4>';
            
            html += '<div class="nine-section">';
            html += '<h5>Front 9</h5>';
            html += '<div class="scorecard-grid">';
            for (var i = 1; i <= 9; i++) {
                var par = course.pars[i-1];
                var value = existingScores[i] || '';
                html += '<div class="hole-input">';
                html += '<label>Hull ' + i + ' (Par ' + par + ')</label>';
                html += '<input type="number" id="hole' + i + '" min="1" max="15" value="' + value + '" ';
                html += 'onchange="autoSaveTeamScore(' + roundId + ', ' + teamIdx + ', ' + i + ')">';
                html += '</div>';
            }
            html += '</div></div>';
            
            html += '<div class="nine-section">';
            html += '<h5>Back 9</h5>';
            html += '<div class="scorecard-grid">';
            for (var i = 10; i <= 18; i++) {
                var par = course.pars[i-1];
                var value = existingScores[i] || '';
                html += '<div class="hole-input">';
                html += '<label>Hull ' + i + ' (Par ' + par + ')</label>';
                html += '<input type="number" id="hole' + i + '" min="1" max="15" value="' + value + '" ';
                html += 'onchange="autoSaveTeamScore(' + roundId + ', ' + teamIdx + ', ' + i + ')">';
                html += '</div>';
            }
            html += '</div></div>';
            
            document.getElementById('scorecardForm').innerHTML = html;
        }
        
        function loadScorecardForm() {
    var playerId = document.getElementById('playerSelect').value;
    var roundId = document.getElementById('selectedRound').value;
    
    if (!playerId) return;
    
    var player = players.find(function(p) { return p.id == playerId; });
    var round = schedule.find(function(r) { return r.id == roundId; });
    var course = courses[round.course];
    var courseHandicap = Math.round((player.handicap * course.slopeRating) / 113);
    var scoreKey = roundId + '_' + playerId;
    var existingScores = scores[scoreKey] || {};
    
    var html = '<div style="margin: 20px 0; padding: 15px; background: #edf2f7; border-radius: 10px;">';
    html += '<strong>' + player.name + '</strong><br>';
    html += 'Handicap: ' + player.handicap + '<br>';
    html += 'Banehandicap: ' + courseHandicap;
    html += '</div>';
    
    html += '<div class="nine-section">';
    html += '<h5>Front 9</h5>';
    html += '<div class="scorecard-grid">';
    for (var i = 1; i <= 9; i++) {
        var par = course.pars[i-1];
        var hcpIndex = course.handicaps[i-1];
        var value = existingScores[i] || '';
        
        // Calculate strokes for this hole
        var strokesOnHole = 0;
        if (courseHandicap >= 18) {
            strokesOnHole = 1; // At least one stroke on every hole
            if (hcpIndex <= (courseHandicap - 18)) {
                strokesOnHole = 2; // Additional stroke on hardest holes
            }
            if (courseHandicap >= 36 && hcpIndex <= (courseHandicap - 36)) {
                strokesOnHole = 3; // Third stroke on hardest holes
            }
        } else {
            if (hcpIndex <= courseHandicap) {
                strokesOnHole = 1;
            }
        }
        
        var hasStroke = strokesOnHole > 0;
        var strokeText = strokesOnHole > 0 ? '+' + strokesOnHole : '';
        
        html += '<div class="hole-input ' + (hasStroke ? 'stroke' : '') + '">';
        html += '<label>Hull ' + i + ' (Par ' + par + strokeText + ')</label>';
        html += '<div style="font-size: 11px; color: #718096; margin-bottom: 3px;">SI: ' + hcpIndex + '</div>';
        html += '<input type="number" id="hole' + i + '" min="1" max="15" value="' + value + '" ';
        html += 'onchange="autoSaveScore(' + playerId + ', ' + roundId + ', ' + i + ')">';
        html += '</div>';
    }
    html += '</div></div>';
    
    html += '<div class="nine-section">';
    html += '<h5>Back 9</h5>';
    html += '<div class="scorecard-grid">';
    for (var i = 10; i <= 18; i++) {
        var par = course.pars[i-1];
        var hcpIndex = course.handicaps[i-1];
        var value = existingScores[i] || '';
        
        // Calculate strokes for this hole
        var strokesOnHole = 0;
        if (courseHandicap >= 18) {
            strokesOnHole = 1; // At least one stroke on every hole
            if (hcpIndex <= (courseHandicap - 18)) {
                strokesOnHole = 2; // Additional stroke on hardest holes
            }
            if (courseHandicap >= 36 && hcpIndex <= (courseHandicap - 36)) {
                strokesOnHole = 3; // Third stroke on hardest holes
            }
        } else {
            if (hcpIndex <= courseHandicap) {
                strokesOnHole = 1;
            }
        }
        
        var hasStroke = strokesOnHole > 0;
        var strokeText = strokesOnHole > 0 ? '+' + strokesOnHole : '';
        
        html += '<div class="hole-input ' + (hasStroke ? 'stroke' : '') + '">';
        html += '<label>Hull ' + i + ' (Par ' + par + strokeText + ')</label>';
        html += '<div style="font-size: 11px; color: #718096; margin-bottom: 3px;">SI: ' + hcpIndex + '</div>';
        html += '<input type="number" id="hole' + i + '" min="1" max="15" value="' + value + '" ';
        html += 'onchange="autoSaveScore(' + playerId + ', ' + roundId + ', ' + i + ')">';
        html += '</div>';
    }
    html += '</div></div>';
    
    document.getElementById('holesForm').innerHTML = html;
}
        
        function autoSaveScore(playerId, roundId, hole) {
            var scoreKey = roundId + '_' + playerId;
            var value = document.getElementById('hole' + hole).value;
            
            if (!scores[scoreKey]) scores[scoreKey] = {};
            
            if (value === '') {
                delete scores[scoreKey][hole];
            } else {
                scores[scoreKey][hole] = parseInt(value);
            }
            
            localStorage.setItem('golfScores2025', JSON.stringify(scores));
            
            var input = document.getElementById('hole' + hole);
            input.style.backgroundColor = '#c6f6d5';
            setTimeout(function() {
                input.style.backgroundColor = '';
            }, 500);
        }
        
        function autoSaveTeamScore(roundId, teamIdx, hole) {
            var scoreKey = roundId + '_team_' + teamIdx;
            var value = document.getElementById('hole' + hole).value;
            
            if (!scrambleScores[scoreKey]) scrambleScores[scoreKey] = {};
            
            if (value === '') {
                delete scrambleScores[scoreKey][hole];
            } else {
                scrambleScores[scoreKey][hole] = parseInt(value);
            }
            
            localStorage.setItem('scrambleScores2025', JSON.stringify(scrambleScores));
            
            var input = document.getElementById('hole' + hole);
            input.style.backgroundColor = '#c6f6d5';
            setTimeout(function() {
                input.style.backgroundColor = '';
            }, 500);
        }
        
        function loadLeaderboard() {
            var html = '<div class="overall-section"><h3>⭐ SAMMENLAGT STILLING ⭐</h3>';
            html += '<div class="overall-table"><div class="table-wrapper">';
            html += '<table><thead><tr><th>Spiller</th><th>Total Brutto</th><th>Total Netto</th></tr></thead><tbody>';
            
            var overallScores = {};
            players.forEach(function(player) {
                overallScores[player.name] = { gross: 0, net: 0, rounds: 0 };
            });
            
            // Calculate individual round scores
            schedule.forEach(function(round) {
                if (round.type === 'Individuell') {
                    players.forEach(function(player) {
                        var scoreKey = round.id + '_' + player.id;
                        var roundScores = scores[scoreKey];
                        
                        if (roundScores && Object.keys(roundScores).length > 0) {
                            var gross = 0;
                            Object.values(roundScores).forEach(function(s) { gross += s; });
                            
                            var course = courses[round.course];
                            var courseHandicap = Math.round((player.handicap * course.slopeRating) / 113);
                            var net = gross - courseHandicap;
                            
                            overallScores[player.name].gross += gross;
                            overallScores[player.name].net += net;
                            overallScores[player.name].rounds++;
                        }
                    });
                }
            });
            
            // Calculate scramble scores - using team handicap
            schedule.forEach(function(round) {
                if (round.type === 'Scramble' && round.teams) {
                    round.teams.forEach(function(team, teamIdx) {
                        var scoreKey = round.id + '_team_' + teamIdx;
                        var teamScores = scrambleScores[scoreKey];
                        
                        if (teamScores && Object.keys(teamScores).length > 0) {
                            var teamGross = 0;
                            Object.values(teamScores).forEach(function(s) { teamGross += s; });
                            
                            var teamHandicap = calculateScrambleHandicap(team, round.course);
                            var teamNet = teamGross - teamHandicap;
                            
                            // Distribute scores to team members
                            team.forEach(function(playerName) {
                                overallScores[playerName].gross += teamGross / 2;
                                overallScores[playerName].net += teamNet / 2;
                                overallScores[playerName].rounds++;
                            });
                        }
                    });
                }
            });
            
            // Sort and display
            var sortedOverall = [];
            Object.keys(overallScores).forEach(function(name) {
                if (overallScores[name].rounds > 0) {
                    sortedOverall.push({
                        name: name,
                        gross: overallScores[name].gross,
                        net: overallScores[name].net
                    });
                }
            });
            
            sortedOverall.sort(function(a, b) { return a.net - b.net; });
            
            sortedOverall.forEach(function(player, idx) {
                html += '<tr>';
                html += '<td>' + (idx === 0 ? '<span class="trophy">🏆</span>' : '') + player.name + '</td>';
                html += '<td>' + Math.round(player.gross) + '</td>';
                html += '<td><strong>' + Math.round(player.net) + '</strong></td>';
                html += '</tr>';
            });
            
            html += '</tbody></table></div></div></div>';
            
            // Add round-by-round results
            html += '<h2 style="margin-top: 30px;">Resultater per Runde</h2>';
            
            schedule.forEach(function(round) {
                var course = courses[round.course];
                html += '<div class="course-section">';
                html += '<h3>' + round.date + ' - ' + round.time + '</h3>';
                html += '<h4>' + round.course + ' (Par ' + course.par + ')</h4>';
                
                if (round.type === 'Individuell') {
                    var roundResults = [];
                    
                    players.forEach(function(player) {
                        var scoreKey = round.id + '_' + player.id;
                        var roundScores = scores[scoreKey];
                        
                        if (roundScores && Object.keys(roundScores).length > 0) {
                            var gross = 0;
                            Object.values(roundScores).forEach(function(s) { gross += s; });
                            
                            var courseHandicap = Math.round((player.handicap * course.slopeRating) / 113);
                            var net = gross - courseHandicap;
                            
                            roundResults.push({
                                name: player.name,
                                gross: gross,
                                net: net,
                                handicap: courseHandicap
                            });
                        }
                    });
                    
                    if (roundResults.length > 0) {
                        roundResults.sort(function(a, b) { return a.net - b.net; });
                        
                        html += '<div class="table-wrapper">';
                        html += '<table><thead><tr>';
                        html += '<th>Plass</th><th>Spiller</th><th>Brutto</th><th>HCP</th><th>Netto</th>';
                        html += '</tr></thead><tbody>';
                        
                        roundResults.forEach(function(result, idx) {
                            html += '<tr>';
                            html += '<td>' + (idx + 1) + (idx === 0 ? ' 🥇' : idx === 1 ? ' 🥈' : idx === 2 ? ' 🥉' : '') + '</td>';
                            html += '<td>' + result.name + '</td>';
                            html += '<td>' + result.gross + '</td>';
                            html += '<td>' + result.handicap.toFixed(1) + '</td>';
                            html += '<td><strong>' + result.net.toFixed(1) + '</strong></td>';
                            html += '</tr>';
                        });
                        
                        html += '</tbody></table></div>';
                        
                        // Show competition winners for scrambles
                        if (round.longestDrive || round.closestToPin) {
                            html += '<div class="team-section" style="margin-top: 10px;">';
                            html += '<strong>Konkurranser:</strong><br>';
                            
                            if (round.longestDrive) {
                                round.longestDrive.forEach(function(hole) {
                                    var winner = awards[round.id + '_ld_' + hole] || 'Ikke satt';
                                    html += '<div>🚀 Lengste drive hull ' + hole + ': <strong>' + winner + '</strong></div>';
                                });
                            }
                            
                            if (round.closestToPin) {
                                round.closestToPin.forEach(function(hole) {
                                    var winner = awards[round.id + '_ctp_' + hole] || 'Ikke satt';
                                    html += '<div>🎯 Nærmest pinnen hull ' + hole + ': <strong>' + winner + '</strong></div>';
                                });
                            }
                            
                            html += '</div>';
                        }
                    }
                    
                    // Show competition winners
                    if (round.longestDrive || round.closestToPin) {
                        html += '<div class="team-section" style="margin-top: 10px;">';
                        html += '<strong>Konkurranser:</strong><br>';
                        
                        if (round.longestDrive) {
                            round.longestDrive.forEach(function(hole) {
                                var winner = awards[round.id + '_ld_' + hole] || 'Ikke satt';
                                html += '<div>🚀 Lengste drive hull ' + hole + ': <strong>' + winner + '</strong></div>';
                            });
                        }
                        
                        if (round.closestToPin) {
                            round.closestToPin.forEach(function(hole) {
                                var winner = awards[round.id + '_ctp_' + hole] || 'Ikke satt';
                                html += '<div>🎯 Nærmest pinnen hull ' + hole + ': <strong>' + winner + '</strong></div>';
                            });
                        }
                        
                        html += '</div>';
                    }
                } else {
                    // Scramble results with team handicaps
                    var teamResults = [];
                    
                    round.teams.forEach(function(team, teamIdx) {
                        var scoreKey = round.id + '_team_' + teamIdx;
                        var teamScores = scrambleScores[scoreKey];
                        
                        if (teamScores && Object.keys(teamScores).length > 0) {
                            var total = 0;
                            Object.values(teamScores).forEach(function(s) { total += s; });
                            
                            var teamHandicap = calculateScrambleHandicap(team, round.course);
                            var netScore = total - teamHandicap;
                            
                            teamResults.push({
                                teamIdx: teamIdx,
                                members: team.join(' & '),
                                gross: total,
                                handicap: teamHandicap,
                                net: netScore
                            });
                        }
                    });
                    
                    if (teamResults.length > 0) {
                        // Sort by net score
                        teamResults.sort(function(a, b) { return a.net - b.net; });
                        
                        html += '<h5>Scramble Resultater</h5>';
                        html += '<div class="table-wrapper">';
                        html += '<table><thead><tr>';
                        html += '<th>Plass</th><th>Lag</th><th>Brutto</th><th>HCP</th><th>Netto</th><th>+/-</th>';
                        html += '</tr></thead><tbody>';
                        
                        teamResults.forEach(function(result, idx) {
                            var diff = result.net - course.par;
                            var diffStr = diff === 0 ? 'E' : (diff > 0 ? '+' + diff : diff.toString());
                            
                            html += '<tr' + (idx === 0 ? ' class="winner"' : '') + '>';
                            html += '<td>' + (idx + 1) + (idx === 0 ? ' 🏆' : '') + '</td>';
                            html += '<td>Lag ' + (result.teamIdx + 1) + ': ' + result.members + '</td>';
                            html += '<td>' + result.gross + '</td>';
                            html += '<td>' + result.handicap + '</td>';
                            html += '<td><strong>' + result.net + '</strong></td>';
                            html += '<td>' + diffStr + '</td>';
                            html += '</tr>';
                        });
                        
                        html += '</tbody></table></div>';
                        
                        // Show competition winners for scrambles
                        if (round.longestDrive || round.closestToPin) {
                            html += '<div class="team-section" style="margin-top: 10px;">';
                            html += '<strong>Konkurranser:</strong><br>';
                            
                            if (round.longestDrive) {
                                round.longestDrive.forEach(function(hole) {
                                    var winner = awards[round.id + '_ld_' + hole] || 'Ikke satt';
                                    html += '<div>🚀 Lengste drive hull ' + hole + ': <strong>' + winner + '</strong></div>';
                                });
                            }
                            
                            if (round.closestToPin) {
                                round.closestToPin.forEach(function(hole) {
                                    var winner = awards[round.id + '_ctp_' + hole] || 'Ikke satt';
                                    html += '<div>🎯 Nærmest pinnen hull ' + hole + ': <strong>' + winner + '</strong></div>';
                                });
                            }
                            
                            html += '</div>';
                        }
                    } else {
                        html += '<p style="color: #718096;">Ingen resultater registrert ennå</p>';
                    }
                }
                
                html += '</div>';
            });
            
            document.getElementById('leaderboardContent').innerHTML = html;
        }
        
        function loadCourses() {
            var html = '';
            
            Object.keys(courses).forEach(function(courseName) {
                var courseData = courses[courseName];
                html += '<div class="course-section">';
                html += '<h3>' + courseName + '</h3>';
                html += '<p>Par: ' + courseData.par + ' | Slope: ' + courseData.slopeRating + '</p>';
                
                schedule.forEach(function(round) {
                    if (round.course === courseName) {
                        html += '<h4>' + round.date + ' - ' + round.time + ' (' + round.type + ')</h4>';
                        
                        if (round.type === 'Individuell') {
                            // Show individual scorecards with Front 9 and Back 9 separate
                            
                            // Front 9
                            html += '<div style="margin-bottom: 20px;">';
                            html += '<h5>Front 9</h5>';
                            html += '<div class="table-wrapper">';
                            html += '<table><thead><tr><th>Spiller</th>';
                            for (var i = 1; i <= 9; i++) {
                                html += '<th>' + i + '</th>';
                            }
                            html += '<th>Out</th></tr></thead><tbody>';
                            
                            // Par row
                            html += '<tr><td>Par</td>';
                            var frontPar = 0;
                            for (var i = 0; i < 9; i++) {
                                html += '<td>' + courseData.pars[i] + '</td>';
                                frontPar += courseData.pars[i];
                            }
                            html += '<td><strong>' + frontPar + '</strong></td></tr>';
                            
                            // Player scores
                            players.forEach(function(player) {
                                var scoreKey = round.id + '_' + player.id;
                                var roundScores = scores[scoreKey];
                                
                                if (roundScores && Object.keys(roundScores).length > 0) {
                                    html += '<tr><td>' + player.name + '</td>';
                                    var frontTotal = 0;
                                    for (var i = 1; i <= 9; i++) {
                                        var score = roundScores[i] || '-';
                                        html += '<td>' + score + '</td>';
                                        if (score !== '-') frontTotal += score;
                                    }
                                    html += '<td><strong>' + (frontTotal || '-') + '</strong></td></tr>';
                                }
                            });
                            
                            html += '</tbody></table></div>';
                            
                            // Back 9
                            html += '<h5>Back 9</h5>';
                            html += '<div class="table-wrapper">';
                            html += '<table><thead><tr><th>Spiller</th>';
                            for (var i = 10; i <= 18; i++) {
                                html += '<th>' + i + '</th>';
                            }
                            html += '<th>In</th></tr></thead><tbody>';
                            
                            // Par row
                            html += '<tr><td>Par</td>';
                            var backPar = 0;
                            for (var i = 9; i < 18; i++) {
                                html += '<td>' + courseData.pars[i] + '</td>';
                                backPar += courseData.pars[i];
                            }
                            html += '<td><strong>' + backPar + '</strong></td></tr>';
                            
                            // Player scores
                            players.forEach(function(player) {
                                var scoreKey = round.id + '_' + player.id;
                                var roundScores = scores[scoreKey];
                                
                                if (roundScores && Object.keys(roundScores).length > 0) {
                                    html += '<tr><td>' + player.name + '</td>';
                                    var backTotal = 0;
                                    for (var i = 10; i <= 18; i++) {
                                        var score = roundScores[i] || '-';
                                        html += '<td>' + score + '</td>';
                                        if (score !== '-') backTotal += score;
                                    }
                                    html += '<td><strong>' + (backTotal || '-') + '</strong></td></tr>';
                                }
                            });
                            
                            html += '</tbody></table></div>';
                            
                            // Totals summary
                            html += '<h5>Totaler</h5>';
                            html += '<div class="table-wrapper">';
                            html += '<table><thead><tr><th>Spiller</th><th>Front 9</th><th>Back 9</th><th>Total</th></tr></thead><tbody>';
                            
                            players.forEach(function(player) {
                                var scoreKey = round.id + '_' + player.id;
                                var roundScores = scores[scoreKey];
                                
                                if (roundScores && Object.keys(roundScores).length > 0) {
                                    var frontTotal = 0;
                                    var backTotal = 0;
                                    
                                    for (var i = 1; i <= 9; i++) {
                                        if (roundScores[i]) frontTotal += roundScores[i];
                                    }
                                    for (var i = 10; i <= 18; i++) {
                                        if (roundScores[i]) backTotal += roundScores[i];
                                    }
                                    
                                    var total = frontTotal + backTotal;
                                    
                                    html += '<tr>';
                                    html += '<td>' + player.name + '</td>';
                                    html += '<td>' + (frontTotal || '-') + '</td>';
                                    html += '<td>' + (backTotal || '-') + '</td>';
                                    html += '<td><strong>' + (total || '-') + '</strong></td>';
                                    html += '</tr>';
                                }
                            });
                            
                            html += '</tbody></table></div>';
                            html += '</div>';
                            
                        } else {
                            // Show scramble scorecards with Front 9 and Back 9 separate
                            html += '<div class="team-section">';
                            round.teams.forEach(function(team, teamIdx) {
                                var scoreKey = round.id + '_team_' + teamIdx;
                                var teamScores = scrambleScores[scoreKey];
                                var teamHandicap = calculateScrambleHandicap(team, round.course);
                                
                                html += '<div style="margin-bottom: 30px; padding: 15px; background: #f7fafc; border-radius: 10px;">';
                                html += '<h5>Lag ' + (teamIdx + 1) + ': ' + team.join(' & ') + '</h5>';
                                html += '<p style="color: #4299e1;">Team Handicap: ' + teamHandicap.toFixed(1) + ' (70% laveste + 30% høyeste)</p>';
                                
                                if (teamScores && Object.keys(teamScores).length > 0) {
                                    // Front 9
                                    html += '<h6>Front 9</h6>';
                                    html += '<div class="table-wrapper">';
                                    html += '<table><thead><tr><th></th>';
                                    for (var i = 1; i <= 9; i++) {
                                        html += '<th>' + i + '</th>';
                                    }
                                    html += '<th>Out</th></tr></thead><tbody>';
                                    
                                    // Par row
                                    html += '<tr><td>Par</td>';
                                    var frontPar = 0;
                                    for (var i = 0; i < 9; i++) {
                                        html += '<td>' + courseData.pars[i] + '</td>';
                                        frontPar += courseData.pars[i];
                                    }
                                    html += '<td><strong>' + frontPar + '</strong></td></tr>';
                                    
                                    // Team scores
                                    html += '<tr><td>Score</td>';
                                    var frontTotal = 0;
                                    for (var i = 1; i <= 9; i++) {
                                        var score = teamScores[i] || '-';
                                        html += '<td>' + score + '</td>';
                                        if (score !== '-') frontTotal += score;
                                    }
                                    html += '<td><strong>' + (frontTotal || '-') + '</strong></td></tr>';
                                    html += '</tbody></table></div>';
                                    
                                    // Back 9
                                    html += '<h6>Back 9</h6>';
                                    html += '<div class="table-wrapper">';
                                    html += '<table><thead><tr><th></th>';
                                    for (var i = 10; i <= 18; i++) {
                                        html += '<th>' + i + '</th>';
                                    }
                                    html += '<th>In</th></tr></thead><tbody>';
                                    
                                    // Par row
                                    html += '<tr><td>Par</td>';
                                    var backPar = 0;
                                    for (var i = 9; i < 18; i++) {
                                        html += '<td>' + courseData.pars[i] + '</td>';
                                        backPar += courseData.pars[i];
                                    }
                                    html += '<td><strong>' + backPar + '</strong></td></tr>';
                                    
                                    // Team scores
                                    html += '<tr><td>Score</td>';
                                    var backTotal = 0;
                                    for (var i = 10; i <= 18; i++) {
                                        var score = teamScores[i] || '-';
                                        html += '<td>' + score + '</td>';
                                        if (score !== '-') backTotal += score;
                                    }
                                    html += '<td><strong>' + (backTotal || '-') + '</strong></td></tr>';
                                    html += '</tbody></table></div>';
                                    
                                    // Total
                                    var total = frontTotal + backTotal;
                                    var netScore = total - teamHandicap;
                                    var diff = netScore - courseData.par;
                                    var diffStr = diff === 0 ? 'E' : (diff > 0 ? '+' + diff.toFixed(1) : diff.toFixed(1));
                                    html += '<p style="margin-top: 10px; font-size: 16px;"><strong>Brutto: ' + (total || '-') + ' | Netto: ' + netScore.toFixed(1) + ' (' + diffStr + ')</strong></p>';
                                    
                                } else {
                                    html += '<p style="color: #718096;">Ingen score registrert</p>';
                                }
                                
                                html += '</div>';
                            });
                            html += '</div>';
                        }
                    }
                });
                
                html += '</div>';
            });
            
            document.getElementById('coursesContent').innerHTML = html;
        }
        
        function loadHistory() {
            // Get all unique years
            var allYears = [];
            playedCourses.forEach(function(course) {
                course.years.forEach(function(year) {
                    if (allYears.indexOf(year) === -1) {
                        allYears.push(year);
                    }
                });
            });
            allYears.sort(function(a, b) { return b - a; }); // Sort years descending
            
            var html = '<div style="margin-bottom: 20px;">';
            html += '<h3>Skottland Golfturer - Spillte Baner</h3>';
            html += '<p style="color: #718096;">Totalt ' + playedCourses.length + ' forskjellige baner siden 2010</p>';
            html += '</div>';
            
            // Statistics
            var coursesByYear = {};
            allYears.forEach(function(year) {
                coursesByYear[year] = [];
            });
            
            playedCourses.forEach(function(course) {
                course.years.forEach(function(year) {
                    coursesByYear[year].push(course.name);
                });
            });
            
            // Year by year breakdown
            html += '<div style="margin-bottom: 30px;">';
            allYears.forEach(function(year) {
                if (coursesByYear[year] && coursesByYear[year].length > 0) {
                    html += '<div class="course-section" style="margin-bottom: 20px;">';
                    html += '<h4 style="color: #2d3748; margin-bottom: 10px;">' + year;
                    if (year === 2019) html += ' (Jubileumstur!)';
                    html += '</h4>';
                    html += '<div style="background: #f7fafc; padding: 15px; border-radius: 10px;">';
                    coursesByYear[year].forEach(function(courseName) {
                        html += '<div style="padding: 5px 0;">• ' + courseName + '</div>';
                    });
                    html += '</div>';
                    html += '</div>';
                }
            });
            html += '</div>';
            
            // All courses alphabetically
            html += '<h3 style="margin-top: 40px; margin-bottom: 20px;">Alle Baner (Alfabetisk)</h3>';
            html += '<div class="table-wrapper">';
            html += '<table><thead><tr><th>Bane</th><th>År Spilt</th><th>Antall Ganger</th></tr></thead><tbody>';
            
            var sortedCourses = playedCourses.slice().sort(function(a, b) {
                return a.name.localeCompare(b.name);
            });
            
            sortedCourses.forEach(function(course) {
                html += '<tr>';
                html += '<td>' + course.name + '</td>';
                html += '<td>' + course.years.join(', ') + '</td>';
                html += '<td>' + course.years.length + '</td>';
                html += '</tr>';
            });
            
            html += '</tbody></table></div>';
            
            document.getElementById('historyContent').innerHTML = html;
        }
        
        function loadWhisky() {
            var html = '<div style="margin-bottom: 20px;">';
            html += '<h3>🥃 Whisky Collection 2025</h3>';
            html += '<p style="color: #718096;">Hver deltaker tar med sin whisky til turen</p>';
            html += '</div>';
            
            html += '<div class="table-wrapper">';
            html += '<table>';
            html += '<thead>';
            html += '<tr>';
            html += '<th>Deltaker</th>';
            html += '<th>Hoved Whisky</th>';
            html += '<th>Reserve Whisky</th>';
            html += '<th>Status</th>';
            html += '</tr>';
            html += '</thead>';
            html += '<tbody>';
            
            whiskyCollection.forEach(function(entry) {
                html += '<tr>';
                html += '<td><strong>' + entry.owner + '</strong></td>';
                html += '<td>' + (entry.primary || '<span style="color: #cbd5e0;">Ikke valgt</span>') + '</td>';
                html += '<td>' + (entry.reserve || '<span style="color: #cbd5e0;">-</span>') + '</td>';
                
                // Status indicator
                if (entry.primary) {
                    html += '<td><span style="color: #48bb78;">✓ Klar</span></td>';
                } else {
                    html += '<td><span style="color: #f56565;">Venter</span></td>';
                }
                
                html += '</tr>';
            });
            
            html += '</tbody>';
            html += '</table>';
            html += '</div>';
            
            // Summary statistics
            var totalWhiskies = 0;
            var readyCount = 0;
            whiskyCollection.forEach(function(entry) {
                if (entry.primary) {
                    totalWhiskies++;
                    readyCount++;
                }
                if (entry.reserve) {
                    totalWhiskies++;
                }
            });
            
            html += '<div style="margin-top: 30px; padding: 20px; background: #f7fafc; border-radius: 10px;">';
            html += '<h4>Statistikk</h4>';
            html += '<p>Antall deltakere: ' + whiskyCollection.length + '</p>';
            html += '<p>Antall som har valgt whisky: ' + readyCount + ' av ' + whiskyCollection.length + '</p>';
            html += '<p>Totalt antall whiskyer: ' + totalWhiskies + '</p>';
            html += '</div>';
            
            // List of unique whiskies
            var uniqueWhiskies = [];
            whiskyCollection.forEach(function(entry) {
                if (entry.primary && uniqueWhiskies.indexOf(entry.primary) === -1) {
                    uniqueWhiskies.push(entry.primary);
                }
                if (entry.reserve && uniqueWhiskies.indexOf(entry.reserve) === -1) {
                    uniqueWhiskies.push(entry.reserve);
                }
            });
            uniqueWhiskies.sort();
            
            if (uniqueWhiskies.length > 0) {
                html += '<div style="margin-top: 20px; padding: 20px; background: #fef5e7; border-radius: 10px;">';
                html += '<h4>Whisky Merker (' + uniqueWhiskies.length + ' forskjellige)</h4>';
                html += '<div style="columns: 2; column-gap: 20px;">';
                uniqueWhiskies.forEach(function(whisky) {
                    html += '<div style="padding: 3px 0;">• ' + whisky + '</div>';
                });
                html += '</div>';
                html += '</div>';
            }
            
            document.getElementById('whiskyContent').innerHTML = html;
        }
        
        function loadPlayers() {
            var html = '<div class="player-grid">';
            players.forEach(function(player) {
                html += '<div class="player-card">';
                html += '<h4>' + player.name + '</h4>';
                html += '<p>Handicap: ' + player.handicap + '</p>';
                html += '<p style="font-size: 12px; margin-top: 10px;">Banehandicap:</p>';
                
                Object.keys(courses).forEach(function(courseName) {
                    var course = courses[courseName];
                    var courseHandicap = Math.round((player.handicap * course.slopeRating) / 113);
                    html += '<p style="font-size: 11px;">' + courseName + ': ' + courseHandicap + '</p>';
                });
                
                html += '</div>';
            });
            html += '</div>';
            
            // Add scramble handicap info
            html += '<div style="margin-top: 30px; padding: 20px; background: #e6f4ff; border-radius: 10px;">';
            html += '<h3>Scramble Handicap Info</h3>';
            html += '<p>I scramble runder bruker vi <strong>70% av laveste handicap + 30% av høyeste handicap</strong>.</p>';
            html += '<p style="margin-top: 10px;">Beregning for hvert lag:</p>';
            
            // Show scramble handicaps for each round
            schedule.forEach(function(round) {
                if (round.type === 'Scramble') {
                    html += '<div style="margin-top: 15px;">';
                    html += '<h4>' + round.date + ' - ' + round.course + '</h4>';
                    round.teams.forEach(function(team, idx) {
                        var teamHandicap = calculateScrambleHandicap(team, round.course);
                        
                        // Get individual course handicaps for display
                        var course = courses[round.course];
                        var handicaps = [];
                        team.forEach(function(memberName) {
                            var player = players.find(function(p) { return p.name === memberName; });
                            if (player) {
                                var courseHcp = Math.round((player.handicap * course.slopeRating) / 113);
                                handicaps.push(courseHcp);
                            }
                        });
                        handicaps.sort(function(a, b) { return a - b; });
                        
                        html += '<p>Lag ' + (idx + 1) + ' (' + team.join(' & ') + '): ';
                        if (handicaps.length >= 2) {
                            html += 'HCP ' + handicaps[0] + ' & ' + handicaps[handicaps.length - 1];
                            html += ' → <strong>' + teamHandicap.toFixed(1) + ' slag</strong></p>';
                        }
                    });
                    html += '</div>';
                }
            });
            
            html += '</div>';
            
            document.getElementById('playersContent').innerHTML = html;
        }
        
        function loadAdmin() {
            var html = '';
            
            if (!isAdmin) {
                html = '<div class="admin-section">';
                html += '<h3>Admin Pålogging</h3>';
                html += '<p>Passord:</p>';
                html += '<input type="password" id="adminPassword" placeholder="Skriv inn passord">';
                html += '<button onclick="loginAdmin()">Logg inn</button>';
                html += '</div>';
            } else {
                html = '<div class="admin-section">';
                html += '<h3>Administrator Panel</h3>';
                html += '<button onclick="logoutAdmin()" style="background: #fc8181;">Logg ut</button>';

                
                
        // Handicap editing
html += '<button class="collapsible" onclick="toggleSection(this)">Rediger Handicap</button>';
html += '<div class="collapsible-content">';
html += '<div class="handicap-edit-grid">';

players.forEach(function(player) {
    html += '<div class="handicap-edit-item">';
    html += '<label>' + player.name + '</label>';
    html += '<input type="number" step="0.1" id="hcp_' + player.id + '" value="' + player.handicap + '" ';
    html += 'onchange="updateHandicap(' + player.id + ', this.value)">';
    html += '</div>';
});

html += '</div>'; // closes handicap-edit-grid
html += '<button onclick="saveHandicaps()" style="margin-top: 10px;">Lagre Handicap</button>';
html += '<div id="handicapMessage"></div>';
html += '</div>'; // closes collapsible-content
                
                // Flight times editing for both Individual and Scramble
html += '<button class="collapsible" onclick="toggleSection(this)">Starttider for Flights og Scrambles</button>';
html += '<div class="collapsible-content">';

schedule.forEach(function(round) {
    html += '<div style="margin-bottom: 15px; padding: 10px; background: white; border-radius: 8px;">';
    html += '<h5>' + round.date + ' - ' + round.course + ' (' + round.type + ')</h5>';
    
    if (round.type === 'Individuell' && round.flights) {
        round.flights.forEach(function(flight, idx) {
            html += '<div style="margin: 10px 0;">';
            html += '<label style="display: block; margin-bottom: 5px; font-size: 12px;">Flight ' + (idx + 1) + ' (' + flight.players.join(', ') + '):</label>';
            html += '<input type="time" id="flight_' + round.id + '_' + idx + '" value="' + (flight.time || '') + '" style="width: 100%; padding: 5px; border: 1px solid #cbd5e0; border-radius: 5px;">';
            html += '</div>';
        });
    } else if (round.type === 'Scramble' && round.teams) {
        // Add time inputs for scramble teams
        if (!round.teamTimes) {
            round.teamTimes = [];
        }
        round.teams.forEach(function(team, idx) {
            html += '<div style="margin: 10px 0;">';
            html += '<label style="display: block; margin-bottom: 5px; font-size: 12px;">Lag ' + (idx + 1) + ' (' + team.join(' & ') + '):</label>';
            html += '<input type="time" id="scramble_time_' + round.id + '_' + idx + '" value="' + (round.teamTimes && round.teamTimes[idx] ? round.teamTimes[idx] : '') + '" style="width: 100%; padding: 5px; border: 1px solid #cbd5e0; border-radius: 5px;">';
            html += '</div>';
        });
    }
    
    html += '</div>';
});

html += '<button onclick="saveFlightTimes()">Lagre starttider</button>';
html += '</div>'; // closes collapsible-content for flights and scramble
                
                // Competition holes editing
html += '<button class="collapsible" onclick="toggleSection(this)">Konkurransehull (Longest Drive / Closest to Pin)</button>';
html += '<div class="collapsible-content">';

schedule.forEach(function(round) {
    html += '<div style="margin-bottom: 15px; padding: 10px; background: white; border-radius: 8px;">';
    html += '<h5>' + round.date + ' - ' + round.course + ' (' + round.type + ')</h5>';
    
    // Longest Drive
    html += '<div style="margin: 10px 0;">';
    html += '<label style="display: block; margin-bottom: 5px; font-size: 12px;">Longest Drive hull (kommaseparert, f.eks: 5,15):</label>';
    var ldValue = round.longestDrive ? round.longestDrive.join(',') : '';
    html += '<input type="text" id="ld_' + round.id + '" value="' + ldValue + '" style="width: 100%; padding: 5px; border: 1px solid #cbd5e0; border-radius: 5px;">';
    html += '</div>';
    
    // Closest to Pin
    html += '<div style="margin: 10px 0;">';
    html += '<label style="display: block; margin-bottom: 5px; font-size: 12px;">Closest to Pin hull (kommaseparert, f.eks: 2,13):</label>';
    var ctpValue = round.closestToPin ? round.closestToPin.join(',') : '';
    html += '<input type="text" id="ctp_' + round.id + '" value="' + ctpValue + '" style="width: 100%; padding: 5px; border: 1px solid #cbd5e0; border-radius: 5px;">';
    html += '</div>';
    
    html += '</div>';
});

html += '<button onclick="saveCompetitionHoles()">Lagre hull</button>';
html += '</div>'; // closes collapsible-content
                
         // Award winners - for ALL rounds including scrambles
html += '<button class="collapsible" onclick="toggleSection(this)">Konkurransevinnere</button>';
html += '<div class="collapsible-content">';

schedule.forEach(function(round) {
    html += '<div style="margin-bottom: 20px;">';
    html += '<h5>' + round.date + ' - ' + round.course + ' (' + round.type + ')</h5>';
    html += '<div class="award-select">';
    
    // Show competitions for ALL rounds (both Individual and Scramble)
    if (round.longestDrive) {
        round.longestDrive.forEach(function(hole) {
            html += '<div class="award-input">';
            html += '<label>Longest Drive Hull ' + hole + ':</label>';
            html += '<select id="award_' + round.id + '_ld_' + hole + '">';
            html += '<option value="">-- Velg vinner --</option>';
            players.forEach(function(player) {
                var selected = awards[round.id + '_ld_' + hole] === player.name ? 'selected' : '';
                html += '<option value="' + player.name + '" ' + selected + '>' + player.name + '</option>';
            });
            html += '</select>';
            html += '</div>';
        });
    }
    
    if (round.closestToPin) {
        round.closestToPin.forEach(function(hole) {
            html += '<div class="award-input">';
            html += '<label>Closest to Pin Hull ' + hole + ':</label>';
            html += '<select id="award_' + round.id + '_ctp_' + hole + '">';
            html += '<option value="">-- Velg vinner --</option>';
            players.forEach(function(player) {
                var selected = awards[round.id + '_ctp_' + hole] === player.name ? 'selected' : '';
                html += '<option value="' + player.name + '" ' + selected + '>' + player.name + '</option>';
            });
            html += '</select>';
            html += '</div>';
        });
    }
    
    html += '</div>';
    html += '</div>';
});

html += '<button onclick="saveAwards()">Lagre vinnere</button>';
html += '</div>'; // closes collapsible-content

// Scramble winners
html += '<button class="collapsible" onclick="toggleSection(this)">Scramble Vinnere</button>';
html += '<div class="collapsible-content">';

schedule.forEach(function(round) {
    if (round.type === 'Scramble') {
        html += '<div style="margin-bottom: 15px;">';
        html += '<h5>' + round.date + ' - ' + round.course + '</h5>';
        html += '<select id="scramble_' + round.id + '">';
        html += '<option value="">-- Velg vinnende lag --</option>';
        round.teams.forEach(function(team, idx) {
            var selected = scrambleWinners[round.id] === idx ? 'selected' : '';
            html += '<option value="' + idx + '" ' + selected + '>Lag ' + (idx + 1) + ': ' + team.join(' & ') + '</option>';
        });
        html += '</select>';
        html += '</div>';
    }
});

html += '<button onclick="saveScrambleWinners()">Lagre scramble vinnere</button>';
html += '</div>'; // closes collapsible-content

// Played Courses Management
html += '<button class="collapsible" onclick="toggleSection(this)">Administrer Spillte Baner</button>';
html += '<div class="collapsible-content">';

html += '<h5>Legg til ny bane</h5>';
html += '<div style="display: grid; grid-template-columns: 2fr 1fr auto; gap: 10px; margin-bottom: 15px;">';
html += '<input type="text" id="newCourseName" placeholder="Banenavn" style="padding: 8px; border: 1px solid #cbd5e0; border-radius: 5px;">';
html += '<input type="number" id="newCourseYear" placeholder="År" min="2010" max="2030" style="padding: 8px; border: 1px solid #cbd5e0; border-radius: 5px;">';
html += '<button onclick="addPlayedCourse()">Legg til</button>';
html += '</div>';

html += '<h5>Eksisterende baner</h5>';
html += '<div style="max-height: 300px; overflow-y: auto; background: white; padding: 10px; border-radius: 8px;">';

// Sort played courses alphabetically
var sortedPlayedCourses = playedCourses.slice().sort(function(a, b) {
    return a.name.localeCompare(b.name);
});
                
sortedPlayedCourses.forEach(function(course) {
    html += '<div style="margin-bottom: 10px; padding: 10px; background: #f7fafc; border-radius: 5px;">';
    html += '<div style="display: flex; justify-content: space-between; align-items: center;">';
    html += '<div>';
    html += '<strong>' + course.name + '</strong><br>';
    html += '<span style="font-size: 12px; color: #718096;">År: ';
    

    // Make each year individually removable
course.years.forEach(function(year, idx) {
    html += '<span style="display: inline-block; background: white; padding: 2px 6px; margin: 2px; border-radius: 3px;">';
    html += year;
    html += ' <span onclick="removeYearFromCourse(' + course.id + ', ' + year + ')" style="color: #fc8181; cursor: pointer; margin-left: 3px;">×</span>';
    html += '</span>';
});
html += '</span>';
    
    html += '</div>';
    html += '<button onclick="removePlayedCourse(' + course.id + ')" style="background: #fc8181; padding: 5px 10px; font-size: 12px;">Slett</button>';
    html += '</div>';
    html += '<div style="margin-top: 5px;">';
    html += '<input type="number" id="addYear_' + course.id + '" placeholder="Legg til år" min="2010" max="2030" style="width: 100px; padding: 4px; margin-right: 5px; border: 1px solid #cbd5e0; border-radius: 3px;">';
    html += '<button onclick="addYearToCourse(' + course.id + ')" style="padding: 4px 8px; font-size: 12px;">+ År</button>';
    html += '</div>';
    html += '</div>';
});

html += '</div>';
html += '</div>'; // closes collapsible-content

// Whisky Management
html += '<button class="collapsible" onclick="toggleSection(this)">Administrer Whisky Samling</button>';
html += '<div class="collapsible-content">';

whiskyCollection.forEach(function(entry) {
    html += '<div style="margin-bottom: 15px; padding: 10px; background: white; border-radius: 8px;">';
    html += '<h5>' + entry.owner + '</h5>';
    html += '<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px;">';
    
    html += '<div>';
    html += '<label style="display: block; font-size: 12px; margin-bottom: 5px;">Hoved Whisky:</label>';
    html += '<input type="text" id="whisky_primary_' + entry.id + '" value="' + (entry.primary || '') + '" ';
    html += 'placeholder="F.eks. Glenmorangie" style="width: 100%; padding: 5px; border: 1px solid #cbd5e0; border-radius: 5px;">';
    html += '</div>';
    
    html += '<div>';
    html += '<label style="display: block; font-size: 12px; margin-bottom: 5px;">Reserve Whisky:</label>';
    html += '<input type="text" id="whisky_reserve_' + entry.id + '" value="' + (entry.reserve || '') + '" ';
    html += 'placeholder="Valgfritt" style="width: 100%; padding: 5px; border: 1px solid #cbd5e0; border-radius: 5px;">';
    html += '</div>';
    
    html += '</div>';
    html += '</div>';
});

html += '<button onclick="saveWhisky()">Lagre Whisky Samling</button>';
html += '</div>'; // closes collapsible-content

// Course Management Section
html += '<button class="collapsible" onclick="toggleSection(this)">🏌️ Administrer Banedata</button>';
html += '<div class="collapsible-content">';
html += '<div class="course-selector">';
html += '<label>Velg bane å redigere:</label>';
html += '<select id="courseSelect" onchange="loadCourseDataForEdit()">';
html += '<option value="Cullen Links">Cullen Links</option>';
html += '<option value="Spey Bay">Spey Bay</option>';
html += '<option value="Strathlene">Strathlene</option>';
html += '<option value="Garmouth & Kingston">Garmouth & Kingston</option>';
html += '</select>';
html += '</div>';

html += '<div class="course-basic-info">';
html += '<div class="course-input-group">';
html += '<label>Slope Rating (55-155):</label>';
html += '<input type="number" id="slopeRating" min="55" max="155" step="1">';
html += '</div>';
html += '<div class="course-input-group">';
html += '<label>Course Rating:</label>';
html += '<input type="number" id="courseRating" step="0.1">';
html += '</div>';
html += '<div class="course-input-group">';
html += '<label>Total Par:</label>';
html += '<input type="number" id="totalPar" readonly style="background: #e2e8f0;">';
html += '</div>';
html += '</div>';

html += '<h5 style="margin: 15px 0;">Hull 1-9 (Front 9)</h5>';
html += '<div class="holes-grid" id="front9Grid"></div>';

html += '<h5 style="margin: 15px 0;">Hull 10-18 (Back 9)</h5>';
html += '<div class="holes-grid" id="back9Grid"></div>';

html += '<button class="save-course-btn" onclick="saveCourseData()">Lagre Banedata</button>';
html += '<div id="courseMessage"></div>';
html += '</div>'; // closes collapsible-content

html += '</div>'; // closes admin-section div
html += '</div>'; // if there's another wrapper div
}
            
            document.getElementById('adminContent').innerHTML = html;
            // Load course data if admin
            if (isAdmin) {
                setTimeout(function() {
                    if (document.getElementById('courseSelect')) {
                        loadCourseDataForEdit();
                    }
                }, 100);
            }
        }
        
        function loginAdmin() {
            var password = document.getElementById('adminPassword').value;
            if (password === 'golf') {
                isAdmin = true;
                loadAdmin();
            } else {
                alert('Feil passord');
            }
        }
        
        function logoutAdmin() {
            isAdmin = false;
            loadAdmin();
        }
        
        function updateHandicap(playerId, value) {
            var player = players.find(function(p) { return p.id === playerId; });
            if (player) {
                player.handicap = parseFloat(value);
            }
        }
        
        function saveHandicaps() {
            localStorage.setItem('golfPlayers2025', JSON.stringify(players));
            saveToServer();
            document.getElementById('handicapMessage').innerHTML = '<div class="success-message">Handicap lagret!</div>';
            setTimeout(function() {
                document.getElementById('handicapMessage').innerHTML = '';
            }, 3000);
        }
        
        function saveFlightTimes() {
            schedule.forEach(function(round) {
                if (round.type === 'Individuell' && round.flights) {
                    round.flights.forEach(function(flight, idx) {
                        var input = document.getElementById('flight_' + round.id + '_' + idx);
                        if (input) {
                            flight.time = input.value;
                        }
                    });
                } else if (round.type === 'Scramble' && round.teams) {
                    if (!round.teamTimes) {
                        round.teamTimes = [];
                    }
                    round.teams.forEach(function(team, idx) {
                        var input = document.getElementById('scramble_time_' + round.id + '_' + idx);
                        if (input) {
                            round.teamTimes[idx] = input.value;
                        }
                    });
                }
            });
            
            localStorage.setItem('golfSchedule2025', JSON.stringify(schedule));
            saveToServer();
            alert('Starttider lagret!');
        }
        
        function saveCompetitionHoles() {
            schedule.forEach(function(round) {
                var ldInput = document.getElementById('ld_' + round.id);
                var ctpInput = document.getElementById('ctp_' + round.id);
                
                if (ldInput) {
                    var ldValue = ldInput.value;
                    if (ldValue) {
                        round.longestDrive = ldValue.split(',').map(function(h) { 
                            return parseInt(h.trim()); 
                        });
                    } else {
                        round.longestDrive = [];
                    }
                }
                
                if (ctpInput) {
                    var ctpValue = ctpInput.value;
                    if (ctpValue) {
                        round.closestToPin = ctpValue.split(',').map(function(h) { 
                            return parseInt(h.trim()); 
                        });
                    } else {
                        round.closestToPin = [];
                    }
                }
            });
            
            localStorage.setItem('golfSchedule2025', JSON.stringify(schedule));
            saveToServer();
            alert('Konkurransehull lagret!');
            loadAdmin(); // Reload to update award selectors
        }
        
        function saveAwards() {
            schedule.forEach(function(round) {
                // Save awards for ALL rounds, including scrambles
                if (round.longestDrive) {
                    round.longestDrive.forEach(function(hole) {
                        var select = document.getElementById('award_' + round.id + '_ld_' + hole);
                        if (select) {
                            awards[round.id + '_ld_' + hole] = select.value;
                        }
                    });
                }
                
                if (round.closestToPin) {
                    round.closestToPin.forEach(function(hole) {
                        var select = document.getElementById('award_' + round.id + '_ctp_' + hole);
                        if (select) {
                            awards[round.id + '_ctp_' + hole] = select.value;
                        }
                    });
                }
            });
            
            localStorage.setItem('golfAwards2025', JSON.stringify(awards));
            saveToServer();
            alert('Vinnere lagret!');
        }
        
        function saveScrambleWinners() {
            schedule.forEach(function(round) {
                if (round.type === 'Scramble') {
                    var select = document.getElementById('scramble_' + round.id);
                    if (select && select.value !== '') {
                        scrambleWinners[round.id] = parseInt(select.value);
                    }
                }
            });
            
            localStorage.setItem('scrambleWinners2025', JSON.stringify(scrambleWinners));
            saveToServer();
            alert('Scramble vinnere lagret!');
        }
        
        function addPlayedCourse() {
            var name = document.getElementById('newCourseName').value;
            var year = parseInt(document.getElementById('newCourseYear').value);
            
            if (!name || !year) {
                alert('Vennligst fyll inn både banenavn og år');
                return;
            }
            
            // Check if course already exists
            var existingCourse = playedCourses.find(function(c) { 
                return c.name.toLowerCase() === name.toLowerCase(); 
            });
            
            if (existingCourse) {
                // Add year to existing course if not already there
                if (existingCourse.years.indexOf(year) === -1) {
                    existingCourse.years.push(year);
                    existingCourse.years.sort();
                }
            } else {
                // Add new course
                var newId = Math.max.apply(null, playedCourses.map(function(c) { return c.id; })) + 1;
                playedCourses.push({
                    id: newId,
                    name: name,
                    years: [year]
                });
            }
            
            localStorage.setItem('playedCourses2025', JSON.stringify(playedCourses));
            saveToServer();
            document.getElementById('newCourseName').value = '';
            document.getElementById('newCourseYear').value = '';
            loadAdmin();
            alert('Bane lagt til!');
        }
        
        function addYearToCourse(courseId) {
            var year = parseInt(document.getElementById('addYear_' + courseId).value);
            
            if (!year) {
                alert('Vennligst oppgi år');
                return;
            }
            
            var course = playedCourses.find(function(c) { return c.id === courseId; });
            if (course) {
                if (course.years.indexOf(year) === -1) {
                    course.years.push(year);
                    course.years.sort();
                    localStorage.setItem('playedCourses2025', JSON.stringify(playedCourses));
                    saveToServer();
                    loadAdmin();
                    alert('År lagt til!');
                } else {
                    alert('Dette året er allerede registrert for denne banen');
                }
            }
        }
        
        function removePlayedCourse(courseId) {
            if (confirm('Er du sikker på at du vil slette denne banen?')) {
                playedCourses = playedCourses.filter(function(c) { return c.id !== courseId; });
                localStorage.setItem('playedCourses2025', JSON.stringify(playedCourses));
                saveToServer();
                loadAdmin();
                alert('Bane slettet!');
            }
        }
        function removeYearFromCourse(courseId, year) {
    var course = playedCourses.find(function(c) { return c.id === courseId; });
    if (course) {
        var yearIndex = course.years.indexOf(year);
        if (yearIndex > -1) {
            if (course.years.length === 1) {
                // If this is the last year, ask if they want to remove the entire course
                if (confirm('Dette er det siste året for denne banen. Vil du slette hele banen?')) {
                    removePlayedCourse(courseId);
                }
            } else {
                course.years.splice(yearIndex, 1);
                localStorage.setItem('playedCourses2025', JSON.stringify(playedCourses));
                saveToServer();
                loadAdmin();
            }
        }
    }
}
        function loadWeather() {
            var html = '<div style="margin-bottom: 20px;">';
            html += '<p style="color: #718096;">Værmelding for alle golfbaner</p>';
            html += '</div>';
            
            // Cullen Links weather
            html += '<div style="margin-bottom: 30px;">';
            html += '<h3 style="color: #2d3748; margin-bottom: 10px;">Cullen Links</h3>';
            html += '<p style="color: #718096; font-size: 14px; margin-bottom: 10px;">Ved kysten, kan være vindfullt</p>';
            html += '<div style="width: 100%; background: #f7fafc; padding: 10px; border-radius: 10px;">';
            html += '<iframe src="https://www.yr.no/nb/innhold/2-2651752/table.html" ';
            html += 'width="100%" height="450" frameborder="0" ';
            html += 'style="border: none; border-radius: 10px; background: white;">';
            html += '</iframe>';
            html += '</div>';
            html += '</div>';
            
            // Spey Bay weather
            html += '<div style="margin-bottom: 30px;">';
            html += '<h3 style="color: #2d3748; margin-bottom: 10px;">Spey Bay</h3>';
            html += '<p style="color: #718096; font-size: 14px; margin-bottom: 10px;">Også kystnært, lignende forhold som Cullen</p>';
            html += '<div style="width: 100%; background: #f7fafc; padding: 10px; border-radius: 10px;">';
            html += '<iframe src="https://www.yr.no/nb/innhold/2-12266629/table.html" ';
            html += 'width="100%" height="450" frameborder="0" ';
            html += 'style="border: none; border-radius: 10px; background: white;">';
            html += '</iframe>';
            html += '</div>';
            html += '</div>';
            
            // Garmouth & Kingston weather
            html += '<div style="margin-bottom: 30px;">';
            html += '<h3 style="color: #2d3748; margin-bottom: 10px;">Garmouth & Kingston</h3>';
            html += '<p style="color: #718096; font-size: 14px; margin-bottom: 10px;">Innlandsforhold, ofte roligere</p>';
            html += '<div style="width: 100%; background: #f7fafc; padding: 10px; border-radius: 10px;">';
            html += '<iframe src="https://www.yr.no/nb/innhold/2-2648866/table.html" ';
            html += 'width="100%" height="450" frameborder="0" ';
            html += 'style="border: none; border-radius: 10px; background: white;">';
            html += '</iframe>';
            html += '</div>';
            html += '</div>';
            
            // Strathlene weather
            html += '<div style="margin-bottom: 30px;">';
            html += '<h3 style="color: #2d3748; margin-bottom: 10px;">Strathlene</h3>';
            html += '<p style="color: #718096; font-size: 14px; margin-bottom: 10px;">Litt mer beskyttet fra vind</p>';
            html += '<div style="width: 100%; background: #f7fafc; padding: 10px; border-radius: 10px;">';
            html += '<iframe src="https://www.yr.no/nb/innhold/2-2654411/table.html" ';
            html += 'width="100%" height="450" frameborder="0" ';
            html += 'style="border: none; border-radius: 10px; background: white;">';
            html += '</iframe>';
            html += '</div>';
            html += '</div>';
            
            // General weather tips
            html += '<div style="margin-top: 30px; padding: 20px; background: #e6f4ff; border-radius: 10px;">';
            html += '<h4>Værtips for Golf i Skottland</h4>';
            html += '<ul style="margin-left: 20px; margin-top: 10px;">';
            html += '<li style="margin-bottom: 8px;"><strong>Vind:</strong> Over 10 m/s påvirker ballflukten betydelig</li>';
            html += '<li style="margin-bottom: 8px;"><strong>Regn:</strong> Ha alltid regnklær og ekstra hansker</li>';
            html += '<li style="margin-bottom: 8px;"><strong>Temperatur:</strong> Kle deg i lag, været kan endre seg raskt</li>';
            html += '<li style="margin-bottom: 8px;"><strong>Kystbaner:</strong> Cullen og Spey Bay har ofte mer vind</li>';
            html += '<li style="margin-bottom: 8px;"><strong>Innlandsbaner:</strong> Garmouth og Strathlene er mer beskyttet</li>';
            html += '</ul>';
                      html += '</div>';
            
            document.getElementById('weatherContent').innerHTML = html;
        }
        
        function saveWhisky() {
            whiskyCollection.forEach(function(entry) {
                var primaryInput = document.getElementById('whisky_primary_' + entry.id);
                var reserveInput = document.getElementById('whisky_reserve_' + entry.id);
                
                if (primaryInput) {
                    entry.primary = primaryInput.value;
                }
                if (reserveInput) {
                    entry.reserve = reserveInput.value;
                }
            });
            
            localStorage.setItem('whiskyCollection2025', JSON.stringify(whiskyCollection));
            saveToServer();
            alert('Whisky samling lagret!');
            loadAdmin();
        }
        // Course Management Functions
        function loadCourseDataForEdit() {
            var courseName = document.getElementById('courseSelect').value;
            var course = courses[courseName];
            
            if (!course) return;
            
            document.getElementById('slopeRating').value = course.slopeRating;
            document.getElementById('courseRating').value = course.courseRating || course.par;
            
            var front9HTML = '';
            for (var i = 1; i <= 9; i++) {
                front9HTML += '<div class="hole-card">';
                front9HTML += '<h5>Hull ' + i + '</h5>';
                front9HTML += '<div class="hole-input">';
                front9HTML += '<label>Par:</label>';
                front9HTML += '<input type="number" id="par_' + i + '" value="' + course.pars[i-1] + '" min="3" max="5" onchange="updateCoursePar()">';
                front9HTML += '</div>';
                front9HTML += '<div class="hole-input">';
                front9HTML += '<label>Stroke Index:</label>';
                front9HTML += '<input type="number" id="stroke_' + i + '" value="' + course.handicaps[i-1] + '" min="1" max="18">';
                front9HTML += '</div>';
                front9HTML += '</div>';
            }
            document.getElementById('front9Grid').innerHTML = front9HTML;
            
            var back9HTML = '';
            for (var i = 10; i <= 18; i++) {
                back9HTML += '<div class="hole-card">';
                back9HTML += '<h5>Hull ' + i + '</h5>';
                back9HTML += '<div class="hole-input">';
                back9HTML += '<label>Par:</label>';
                back9HTML += '<input type="number" id="par_' + i + '" value="' + course.pars[i-1] + '" min="3" max="5" onchange="updateCoursePar()">';
                back9HTML += '</div>';
                back9HTML += '<div class="hole-input">';
                back9HTML += '<label>Stroke Index:</label>';
                back9HTML += '<input type="number" id="stroke_' + i + '" value="' + course.handicaps[i-1] + '" min="1" max="18">';
                back9HTML += '</div>';
                back9HTML += '</div>';
            }
            document.getElementById('back9Grid').innerHTML = back9HTML;
            
            updateCoursePar();
        }

        function updateCoursePar() {
            var total = 0;
            for (var i = 1; i <= 18; i++) {
                var parInput = document.getElementById('par_' + i);
                if (parInput) {
                    total += parseInt(parInput.value) || 0;
                }
            }
            document.getElementById('totalPar').value = total;
        }

        function saveCourseData() {
            var courseName = document.getElementById('courseSelect').value;
            
            courses[courseName].slopeRating = parseInt(document.getElementById('slopeRating').value);
            courses[courseName].courseRating = parseFloat(document.getElementById('courseRating').value) || courses[courseName].par;
            
            var pars = [];
            var handicaps = [];
            
            for (var i = 1; i <= 18; i++) {
                pars.push(parseInt(document.getElementById('par_' + i).value));
                handicaps.push(parseInt(document.getElementById('stroke_' + i).value));
            }
            
            var strokeCheck = {};
            for (var i = 0; i < handicaps.length; i++) {
                if (handicaps[i] < 1 || handicaps[i] > 18) {
                    alert('Stroke index må være mellom 1 og 18');
                    return;
                }
                if (strokeCheck[handicaps[i]]) {
                    alert('Stroke index ' + handicaps[i] + ' er brukt flere ganger');
                    return;
                }
                strokeCheck[handicaps[i]] = true;
            }
            
            courses[courseName].pars = pars;
            courses[courseName].handicaps = handicaps;
            courses[courseName].par = pars.reduce(function(a, b) { return a + b; }, 0);
            
            localStorage.setItem('golfCourses2025', JSON.stringify(courses));
            saveToServer();
            
            document.getElementById('courseMessage').innerHTML = '<div class="success-message">Banedata lagret!</div>';
            setTimeout(function() {
                document.getElementById('courseMessage').innerHTML = '';
            }, 3000);
        }
        // Initialize on load
        window.onload = function() {
            syncWithServer();
            updateLanguage();
            trackPageView('home');
        };
    </script>
</body>
</html>
